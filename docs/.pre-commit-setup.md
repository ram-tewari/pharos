# Pre-commit Hooks Setup

This project uses pre-commit hooks to enforce code quality and architecture rules before commits.

## Installation

1. Install pre-commit (if not already installed):
   ```bash
   pip install pre-commit
   ```

2. Install the git hook scripts:
   ```bash
   pre-commit install
   ```

## Hooks

### Module Isolation Check

Validates that modules follow vertical slice architecture rules:
- Modules can only import from the shared kernel (`app.shared`)
- Modules cannot directly import from other modules
- No circular dependencies exist
- Cross-module communication must use events

This hook runs automatically on every commit and push.

## Manual Execution

To manually run all hooks on all files:
```bash
pre-commit run --all-files
```

To run only the module isolation check:
```bash
pre-commit run check-module-isolation --all-files
```

## Bypassing Hooks (Not Recommended)

In rare cases where you need to bypass the hooks:
```bash
git commit --no-verify
```

**Warning:** Bypassing hooks may introduce architecture violations that will fail in CI/CD.

## Troubleshooting

If the module isolation check fails:

1. Run the checker with verbose output:
   ```bash
   python backend/scripts/check_module_isolation.py --verbose --graph
   ```

2. Review the violations and fix them by:
   - Removing direct imports between modules
   - Using event-driven communication instead
   - Moving shared code to `app/shared/`

3. Verify the fix:
   ```bash
   python backend/scripts/check_module_isolation.py
   ```

## CI/CD Integration

The module isolation check also runs in GitHub Actions:
- Runs as a separate job before tests
- Fails the build if violations are found
- Provides detailed reports in the workflow summary

See `.github/workflows/test.yml` for the CI/CD configuration.
